<% title = 'お問い合わせ' %>

<div class="container py-4 text-light">
  <h2 class="mb-4">📩 お問い合わせ</h2>

  <% if (success) { %>
    <div class="alert alert-success text-center fw-bold">
      ✅ <%= success %>
    </div>
  <% } %>

  <% if (error) { %>
    <div class="alert alert-danger text-center fw-bold">
      ❌ <%= error %>
    </div>
  <% } %>

  <form id="contactForm" class="bg-dark p-4 rounded border border-info shadow">
   
    <!-- カテゴリ -->
    <div class="mb-3">
      <label class="form-label fw-bold">カテゴリ</label>
      <div class="d-flex gap-2 flex-wrap">
        <button type="button" class="btn btn-outline-info category-btn" data-value="注文">注文</button>
        <button type="button" class="btn btn-outline-info category-btn" data-value="サービス">サービス</button>
        <button type="button" class="btn btn-outline-info category-btn" data-value="支払い">支払い</button>
        <button type="button" class="btn btn-outline-info category-btn" data-value="その他">その他</button>
      </div>
      <input type="hidden" id="categoryInput">
    </div>

    <!-- サブカテゴリ -->
    <div class="mb-3">
      <label class="form-label fw-bold">サブカテゴリ</label>
      <div class="d-flex gap-2 flex-wrap">
        <button type="button" class="btn btn-outline-secondary subcategory-btn" data-value="保証依頼">保証依頼</button>
        <button type="button" class="btn btn-outline-secondary subcategory-btn" data-value="キャンセル">キャンセル</button>
        <button type="button" class="btn btn-outline-secondary subcategory-btn" data-value="スピードアップ">スピードアップ</button>
        <button type="button" class="btn btn-outline-secondary subcategory-btn" data-value="その他">その他</button>
      </div>
      <input type="hidden" id="subcategoryInput">
    </div>

    <!-- 注文ID -->
    <div class="mb-3">
      <label for="orderId" class="form-label fw-bold">注文ID</label>
      <input type="text" id="orderId" class="form-control bg-dark text-light border-info">
    </div>

    <!-- メールアドレス -->
    <div class="mb-3">
      <label for="email" class="form-label fw-bold">メールアドレス</label>
      <input type="email" id="email" class="form-control bg-dark text-light border-info" required>
    </div>

    <!-- 内容 -->
    <div class="mb-3">
      <label for="message" class="form-label fw-bold">内容</label>
      <textarea id="message" rows="5" class="form-control bg-dark text-light border-info" required></textarea>
    </div>

    <button type="submit" class="btn btn-info w-100 fw-bold py-2">メールアプリで送信</button>
  </form>
</div>

<style>
  .category-btn.active, .subcategory-btn.active {
    background-color: #0dcaf0 !important;
    color: #000 !important;
    font-weight: bold;
  }
</style>

<script>
  // ✅ カテゴリ選択
  document.querySelectorAll(".category-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("categoryInput").value = btn.dataset.value;
    });
  });

  // ✅ サブカテゴリ選択
  document.querySelectorAll(".subcategory-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".subcategory-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("subcategoryInput").value = btn.dataset.value;
    });
  });

  // ✅ メール送信（mailto使用）
  document.getElementById("contactForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const category = document.getElementById("categoryInput").value || "未選択";
    const subcategory = document.getElementById("subcategoryInput").value || "未選択";
    const orderId = document.getElementById("orderId").value || "なし";
    const email = document.getElementById("email").value || "未入力";
    const message = document.getElementById("message").value || "";

    // 宛先（あなたのメールアドレスに変更）
    const to = "star.company527@gmail.com";

    // 件名と本文
    const subject = encodeURIComponent(`【お問い合わせ】${category} - ${subcategory}`);
    const body = encodeURIComponent(
`カテゴリ: ${category}
サブカテゴリ: ${subcategory}
注文ID: ${orderId}
メール: ${email}

内容:
${message}`
    );

    // ✅ メールアプリを開く
    window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
  });
</script>
