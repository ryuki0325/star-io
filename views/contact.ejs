<% title = 'ãŠå•ã„åˆã‚ã›' %>

<div class="container py-4 text-light">
  <h2 class="mb-4">ğŸ“© ãŠå•ã„åˆã‚ã›</h2>

  <!-- âœ… æˆåŠŸ / ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <% if (success) { %>
    <div class="alert alert-success text-center fw-bold" id="msgBox">
      âœ… <%= success %>
    </div>
  <% } else if (error) { %>
    <div class="alert alert-danger text-center fw-bold" id="msgBox">
      âŒ <%= error %>
    </div>
  <% } %>

  <form id="contactForm" action="/contact" method="POST"
        class="bg-dark p-4 rounded border border-info shadow">

    <!-- ã‚«ãƒ†ã‚´ãƒª -->
    <div class="mb-3">
      <label class="form-label fw-bold" aria-label="ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ">ã‚«ãƒ†ã‚´ãƒª</label>
      <div class="d-flex gap-2 flex-wrap">
        <% const categories = ["æ³¨æ–‡","ã‚µãƒ¼ãƒ“ã‚¹","æ”¯æ‰•ã„","ãã®ä»–"]; %>
        <% categories.forEach(cat => { %>
          <button type="button"
                  class="btn btn-outline-info category-btn"
                  data-value="<%= cat %>"><%= cat %></button>
        <% }) %>
      </div>
      <input type="hidden" name="category" id="categoryInput" required>
    </div>

    <!-- ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒª -->
    <div class="mb-3">
      <label class="form-label fw-bold" aria-label="ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ">ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒª</label>
      <div class="d-flex gap-2 flex-wrap">
        <% const subcats = ["ä¿è¨¼ä¾é ¼","ã‚­ãƒ£ãƒ³ã‚»ãƒ«","ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—","ãã®ä»–"]; %>
        <% subcats.forEach(sub => { %>
          <button type="button"
                  class="btn btn-outline-secondary subcategory-btn"
                  data-value="<%= sub %>"><%= sub %></button>
        <% }) %>
      </div>
      <input type="hidden" name="subcategory" id="subcategoryInput" required>
    </div>

    <!-- æ³¨æ–‡ID -->
    <div class="mb-3">
      <label for="orderId" class="form-label fw-bold">æ³¨æ–‡IDï¼ˆä»»æ„ï¼‰</label>
      <input type="text" id="orderId" name="orderId"
             class="form-control bg-dark text-light border-info"
             placeholder="ä¾‹: 123456">
    </div>

    <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ -->
    <div class="mb-3">
      <label for="email" class="form-label fw-bold">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
      <input type="email" id="email" name="email"
             class="form-control bg-dark text-light border-info"
             required placeholder="example@gmail.com">
    </div>

    <!-- å†…å®¹ -->
    <div class="mb-3">
      <label for="message" class="form-label fw-bold">ãŠå•ã„åˆã‚ã›å†…å®¹</label>
      <textarea id="message" name="message" rows="5"
                class="form-control bg-dark text-light border-info"
                required placeholder="ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
    </div>

    <button type="submit" class="btn btn-info w-100 fw-bold py-2">é€ä¿¡ã™ã‚‹</button>
  </form>
</div>

<!-- ğŸ”´ é€ä¿¡ã§ããªã„æ–¹ç”¨ã®ãƒœã‚¿ãƒ³ -->
<div class="mt-3 text-center">
  <button type="button"
          onclick="window.location.href='mailto:star.company527@gmail.com?subject=ãŠå•ã„åˆã‚ã›ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ä¸å¯ï¼‰'"
          style="background-color:#dc3545; color:#fff; border:none; padding:10px 16px; border-radius:6px; font-weight:600; cursor:pointer;">
    é€ä¿¡ã§ããªã„æ–¹ã¯ã“ã¡ã‚‰
  </button>
  <p style="font-size:0.85rem; color:#bbb; margin-top:6px;">
    â€»ãŠä½¿ã„ã®ç’°å¢ƒã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãªã„å ´åˆã¯ã“ã¡ã‚‰ã‚’ã”åˆ©ç”¨ãã ã•ã„
  </p>
</div>

<!-- âœ… ã‚¹ã‚¿ã‚¤ãƒ« -->
<style>
  .category-btn.active,
  .subcategory-btn.active {
    background-color: #0dcaf0 !important;
    color: #000 !important;
    font-weight: bold;
  }
  #msgBox {
    scroll-margin-top: 80px;
  }
</style>

<!-- âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("ğŸ“© ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–");

  const categoryBtns = document.querySelectorAll(".category-btn");
  const subcategoryBtns = document.querySelectorAll(".subcategory-btn");
  const categoryInput = document.getElementById("categoryInput");
  const subcategoryInput = document.getElementById("subcategoryInput");
  const form = document.getElementById("contactForm");
  const emailInput = document.getElementById("email");
  const msgBox = document.getElementById("msgBox");

  // æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  if (msgBox) msgBox.scrollIntoView({ behavior: "smooth", block: "center" });

  // âœ… ã‚«ãƒ†ã‚´ãƒªé¸æŠ
  categoryBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      categoryBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      categoryInput.value = btn.dataset.value;
    });
  });

  // âœ… ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªé¸æŠ
  subcategoryBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      subcategoryBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      subcategoryInput.value = btn.dataset.value;
    });
  });

  // âœ… ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‰ãƒã‚§ãƒƒã‚¯
  form.addEventListener("submit", (e) => {
    const category = categoryInput.value.trim();
    const subcategory = subcategoryInput.value.trim();
    const email = emailInput.value.trim();

    if (!category) {
      e.preventDefault();
      alert("ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
      categoryBtns[0].focus();
      return;
    }

    if (!subcategory) {
      e.preventDefault();
      alert("ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
      subcategoryBtns[0].focus();
      return;
    }

    if (!confirm(`ä»¥ä¸‹ã®å†…å®¹ã§é€ä¿¡ã—ã¾ã™ã€‚\n\nğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${email}\nğŸ—‚ ã‚«ãƒ†ã‚´ãƒª: ${category} / ${subcategory}\n\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
      e.preventDefault();
    }
  });
});
</script>
