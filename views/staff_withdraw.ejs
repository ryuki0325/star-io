<% title = 'å‡ºé‡‘ç”³è«‹ä¸€è¦§ï¼ˆã‚¹ã‚¿ãƒƒãƒ•ï¼‰' %>

<div class="container py-4 text-light">
  <h2 class="mb-3">ğŸ’´ å‡ºé‡‘ç”³è«‹ä¸€è¦§</h2>

  <p class="mb-3">
    æœªå®Œäº†ã®ç”³è«‹ï¼š 
    <% if (pendingCount > 0) { %>
      <span class="badge bg-warning text-dark"><%= pendingCount %> ä»¶</span>
    <% } else { %>
      <span class="badge bg-success">0 ä»¶ï¼ˆå…¨ã¦å‡¦ç†æ¸ˆã¿ï¼‰</span>
    <% } %>
  </p>

  <% if (requests.length === 0) { %>
    <p class="text-muted">ã¾ã å‡ºé‡‘ç”³è«‹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  <% } else { %>

    <div class="table-responsive">
      <table class="table table-dark table-striped align-middle withdraw-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>ç”³è«‹æ—¥æ™‚</th>
            <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID / ãƒ¡ãƒ¼ãƒ«</th>
            <th>é‡‘é¡</th>
            <th>æ–¹æ³•</th>
            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
            <th>é€é‡‘æƒ…å ±</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <% requests.forEach(r => { %>
            <tr class="<%= r.status === 'pending' ? 'pending-row' : '' %>">
              <td><%= r.id %></td>
              <td><%= new Date(r.created_at).toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" }) %></td>
              <td>
                ID: <%= r.user_id %><br>
                <span class="user-email-withdraw"><%= r.user_email %></span>
              </td>
              <td><%= r.amount %> å††</td>
              <td>
                <% if (r.method === 'balance') { %>æ®‹é«˜
                <% } else if (r.method === 'paypay') { %>PayPay
                <% } else if (r.method === 'bank') { %>éŠ€è¡ŒæŒ¯è¾¼
                <% } %>
              </td>
              <td>
                <% if (r.status === 'pending') { %>
                  <span class="badge bg-warning text-dark">æœªå®Œäº†</span>
                <% } else if (r.status === 'approved') { %>
                  <span class="badge bg-success">å®Œäº†</span>
                <% } else if (r.status === 'rejected') { %>
                  <span class="badge bg-danger">å´ä¸‹</span>
                <% } %>
              </td>

              <!-- â–¼ é€é‡‘æƒ…å ± -->
              <td class="send-info-cell">
                <% if (r.method === 'paypay') { %>
                  <div class="send-info-box">
                    <div class="send-info-title">PayPay</div>
                    <div class="send-info-row">IDï¼š<span><%= r.paypay_id %></span></div>
                  </div>
                <% } else if (r.method === 'bank') { %>
                  <div class="send-info-box">
                    <div class="send-info-title">éŠ€è¡ŒæŒ¯è¾¼</div>
                    <div class="send-info-row">éŠ€è¡Œåï¼š<span><%= r.bank_name %></span></div>
                    <div class="send-info-row">æ”¯åº—åï¼š<span><%= r.bank_branch %></span></div>
                    <div class="send-info-row">å£åº§ç•ªå·ï¼š<span><%= r.bank_account %></span></div>
                  </div>
                <% } else { %>
                  <span class="send-info-none">ãªã—</span>
                <% } %>
              </td>

              <td>
                <% if (r.status === 'pending' && r.method !== 'balance') { %>
                  <form action="/staff/withdraw/<%= r.id %>/approve" method="POST" class="d-inline">
                    <button class="btn btn-sm btn-success mb-1" type="submit">å®Œäº†</button>
                  </form>
                  <form action="/staff/withdraw/<%= r.id %>/reject" method="POST" class="d-inline">
                    <button class="btn btn-sm btn-danger mb-1" type="submit">å´ä¸‹</button>
                  </form>
                <% } else { %>
                  <small class="no-action-text">æ“ä½œãªã—</small>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

  <% } %>
</div>

<style>
  /* â–¼ ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã®æ–‡å­—ã‚’ç™½ã«çµ±ä¸€ */
  .withdraw-table,
  .withdraw-table th,
  .withdraw-table td {
    color: #ffffff !important;
  }

  /* ä¿ç•™è¡Œã ã‘å°‘ã—èƒŒæ™¯ã‚’æ¿ƒãã—ã¦ã‚ã‹ã‚Šã‚„ã™ã */
  .withdraw-table .pending-row {
    background: #2c2600 !important;
  }

  /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¼ãƒ«ã‚‚ç™½ã§è¡¨ç¤º */
  .user-email-withdraw {
    color: #ffffff !important;
    font-size: 0.85rem;
    opacity: 0.9;
  }

  /* é€é‡‘æƒ…å ±ã‚»ãƒ« */
  .send-info-cell {
    vertical-align: middle;
  }

  /* é€é‡‘æƒ…å ±ã®ã‚«ãƒ¼ãƒ‰ */
  .send-info-box {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    padding: 6px 10px;
    line-height: 1.6;
    font-size: 0.9rem;
    color: #ffffff;
    box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
  }

  .send-info-title {
    font-weight: 700;
    margin-bottom: 2px;
    font-size: 0.85rem;
    opacity: 0.9;
  }

  .send-info-row span {
    font-weight: 500;
  }

  .send-info-none {
    color: #ffffff !important;
    opacity: 0.7;
    font-size: 0.85rem;
  }

  /* ã€Œæ“ä½œãªã—ã€ã®æ–‡å­—ã‚‚ç™½ */
  .no-action-text {
    color: #ffffff !important;
    opacity: 0.7;
  }
</style>
