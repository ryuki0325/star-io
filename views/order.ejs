<% title = 'æ–°è¦æ³¨æ–‡' %>

<div class="container py-4 text-light">
  <h2 class="mb-4">ğŸš€ æ–°è¦æ³¨æ–‡</h2>

 <!-- ğŸ’³ æ®‹é«˜è¡¨ç¤ºéƒ¨åˆ† -->
<div class="balance-display">
  ğŸ’³ æ®‹é«˜: <span class="balance-amount"><%= balance.toFixed(2) %> å††</span>
</div>

<!-- æ³¨æ–‡ãƒ•ã‚©ãƒ¼ãƒ é–‹å§‹ -->
<form action="/order" method="POST">
  <!-- ã‚¯ã‚¤ãƒƒã‚¯é¸æŠã‚„ã‚µãƒ¼ãƒ“ã‚¹é¸æŠãªã© -->
</form>

  <!-- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <% if (typeof error !== "undefined" && error) { %>
    <div style="color: red; font-weight: bold; margin-bottom: 10px;">
      <%= error %>
    </div>
  <% } %>

  <!-- âœ… æ³¨æ–‡ãƒ•ã‚©ãƒ¼ãƒ  -->
  <form action="/order" method="POST" class="bg-dark p-4 rounded border border-info-subtle shadow">
    
    <!-- ==== ã‚¯ã‚¤ãƒƒã‚¯é¸æŠ ==== -->
    <div class="mb-3">
      <label class="form-label mb-2">ã‚¯ã‚¤ãƒƒã‚¯é¸æŠ</label>
      <div class="d-flex flex-wrap gap-2">
        <% const emojiMap = {
             TikTok:"ğŸµ", Instagram:"ğŸ“¸", YouTube:"â–¶ï¸", Twitter:"âœ–ï¸",
             Spotify:"ğŸ§", Telegram:"âœˆï¸", Twitch:"ğŸ®", Facebook:"ğŸ‘¥", Reddit:"ğŸ‘½"
           };
           const quickApps = ["TikTok","Instagram","YouTube","Twitter","Spotify","Telegram","Twitch","Facebook","Reddit"];
        %>
        <% quickApps.forEach(q => { if (grouped[q]) { %>
          <button type="button"
                  class="app-chip btn btn-outline-info"
                  data-app="<%= q %>">
            <span class="me-1"><%= emojiMap[q] || "ğŸ§©" %></span><%= q %>
          </button>
        <% } }) %>
      </div>
    </div>

    <!-- ==== ã‚¢ãƒ—ãƒªé¸æŠ ==== -->
    <div class="mb-3">
      <label for="appSelect" class="form-label">ã‚¢ãƒ—ãƒªã‚’é¸æŠ</label>
      <div class="select-wrap border border-3 border-info rounded">
        <select class="form-select bg-dark text-light border-0" id="appSelect" onchange="updateTypes()">
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          <% (appOrder || []).forEach(app => { %>
            <option value="<%= app %>" <%= selectedApp === app ? "selected" : "" %>>
              <%= (emojiMap[app] || "ğŸ§©") + " " + app %>
            </option>
          <% }) %>
        </select>
      </div>
    </div>

    <!-- ==== ç¨®é¡é¸æŠ ==== -->
    <div class="mb-3">
      <label for="typeSelect" class="form-label">ç¨®é¡ã‚’é¸æŠ</label>
      <div class="select-wrap border border-3 border-info rounded">
        <select class="form-select bg-dark text-light border-0" id="typeSelect" onchange="updateServices()">
          <option value="">å…ˆã«ã‚¢ãƒ—ãƒªã‚’é¸ã‚“ã§ãã ã•ã„</option>
        </select>
      </div>
    </div>

    <!-- ==== ã‚µãƒ¼ãƒ“ã‚¹é¸æŠ ==== -->
    <div class="mb-3">
      <label for="serviceSelect" class="form-label">ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠï¼ˆå®‰ã„é †ï¼‰</label>
      <div class="select-wrap border border-3 border-info rounded">
        <select class="form-select bg-dark text-light border-0" id="serviceSelect" name="serviceId" onchange="updatePrice()">
          <option value="">å…ˆã«ç¨®é¡ã‚’é¸ã‚“ã§ãã ã•ã„</option>
        </select>
      </div>
      <div class="form-text text-secondary mt-1">ã€Œå˜ä¾¡: xxå††/1000ã€ã¯1000å˜ä½ã‚ãŸã‚Šã®é‡‘é¡ã§ã™</div>
    </div>

    <!-- ==== ãƒªãƒ³ã‚¯ ==== -->
    <div class="mb-3">
      <label for="link" class="form-label">ãƒªãƒ³ã‚¯</label>
      <input type="text" class="form-control bg-dark text-light border border-2 border-info" id="link" name="link" required>
    </div>

    <!-- ==== æ•°é‡ ==== -->
    <div class="mb-3">
      <label for="quantity" class="form-label">æ•°é‡</label>
      <input type="number" class="form-control bg-dark text-light border border-2 border-info" id="quantity" name="quantity" min="1" required oninput="updatePrice()">
    </div>

    <!-- âœ… é‡‘é¡è¡¨ç¤º -->
    <div class="card bg-black border border-3 border-info p-3 mb-3">
      <p id="priceDisplay" class="text-info fs-5 mb-0">é‡‘é¡: 0 å††</p>
    </div>

    <button type="submit" class="btn btn-info w-100 fw-bold py-2">æ³¨æ–‡ã™ã‚‹</button>
  </form>
</div>

<!-- âœ… æ®‹é«˜ç”¨ã‚¹ã‚¿ã‚¤ãƒ« -->
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

 .balance-display {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.6rem;
  text-align: center;
  color: #00eaff;
  background: linear-gradient(135deg, #0a0f2c, #001f3f);
  padding: 15px 30px;
  border: 2px solid #00eaff;
  border-radius: 12px;
  margin: 20px auto;      /* âœ… ãƒ•ã‚©ãƒ¼ãƒ ã¨ä½™ç™½ã‚’ã¨ã‚‹ */
  width: fit-content;     /* âœ… æ¨ªå¹…ã¯å†…å®¹ã«åˆã‚ã›ã‚‹ */
  display: inline-block;  /* âœ… æ¨ªå¹…ã‚’æœ€å°é™ã« */
  z-index: 1;
  position: relative;     /* âœ… ä»–ã®è¦ç´ ã‚’è¦†ã‚ãªã„ã‚ˆã†ã« */
  box-shadow: 0 0 20px rgba(0, 234, 255, 0.7);
  animation: glow 1.5s infinite alternate;
}

@keyframes glow {
  from { box-shadow: 0 0 10px rgba(0, 234, 255, 0.5); }
  to   { box-shadow: 0 0 25px rgba(0, 234, 255, 1); }
}

  .balance-amount {
    font-weight: bold;
    font-size: 2rem;
    color: #39ff14;
    text-shadow: 0 0 10px #39ff14, 0 0 20px #39ff14;
  }


  .select-wrap { overflow: hidden; }
  .select-wrap:focus-within { box-shadow: 0 0 0.6rem rgba(13, 202, 240, 0.5); }
  .app-chip{
    border-width: 2px !important;
    border-radius: 999px;
    padding: .45rem .9rem;
    font-weight: 600;
    backdrop-filter: blur(2px);
  }
  .app-chip.active,
  .app-chip:hover{
    background:#0dcaf0;
    color:#000;
  }
</style>
    
