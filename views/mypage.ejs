<% title = 'ãƒã‚¤ãƒšãƒ¼ã‚¸' %>

<div class="container py-4 text-light">
  <h2 class="mb-4">ãƒã‚¤ãƒšãƒ¼ã‚¸</h2>

  <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
  <div class="card bg-dark border border-info mb-4 p-3">
    <p class="mb-2 text-white">ğŸ“§ ãƒ¡ãƒ¼ãƒ«: <span class="fw-bold text-white"><%= user.email %></span></p>
    <p class="mb-0 text-white">ğŸ’° æ®‹é«˜: <span class="fw-bold text-success"><%= Number(user.balance).toFixed(2) %> å††</span></p>
  </div>

  <!-- ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="card bg-dark text-light mb-4">
    <div class="card-body">
      <h4 class="card-title">ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</h4>

      <% if (pwdError) { %>
        <div class="alert alert-danger"><%= pwdError %></div>
      <% } %>

      <% if (pwdSuccess) { %>
        <div class="alert alert-success"><%= pwdSuccess %></div>
      <% } %>

      <form action="/change-password" method="POST">
        <div class="mb-3">
          <label class="form-label">ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="password" name="currentPassword" class="form-control bg-dark text-light border-info" required>
        </div>
        <div class="mb-3">
          <label class="form-label">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="password" name="newPassword" class="form-control bg-dark text-light border-info" required>
        </div>
        <div class="mb-3">
          <label class="form-label">æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆå†å…¥åŠ›ï¼‰</label>
          <input type="password" name="confirmPassword" class="form-control bg-dark text-light border-info" required>
        </div>
        <button type="submit" class="btn btn-info w-100">å¤‰æ›´ã™ã‚‹</button>
      </form>
    </div>
  </div>

  <!-- ğŸ“ æ³¨æ–‡å±¥æ­´ -->
  <h3 class="mb-3 text-white">ğŸ“ æ³¨æ–‡å±¥æ­´</h3>

  <% if (!orders || orders.length === 0) { %>
    <p class="text-center text-secondary">ã¾ã æ³¨æ–‡å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  <% } else { %>
    <div class="d-flex flex-column gap-3">
      <% orders.forEach(order => { %>
        <div class="order-card border border-info rounded p-3 shadow-sm">
          
          <!-- ã‚µãƒ¼ãƒ“ã‚¹ID & æ—¥æ™‚ -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="badge bg-info text-dark fw-bold px-3 py-2">
              ã‚µãƒ¼ãƒ“ã‚¹ID: <%= order.service_id %>
            </span>
            <span class="badge bg-dark text-white">
              ğŸ“… <%= new Date(order.created_at).toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" }) %>
            </span>
          </div>

          <!-- ã‚µãƒ¼ãƒ“ã‚¹å -->
          <h5 class="text-white mb-2" style="word-break: break-word;">
            âœ¨ <%= order.service_name %>
          </h5>

          <!-- ã‚µãƒ¼ãƒ“ã‚¹è©³ç´° -->
          <p class="mb-1 text-white">
            ğŸ”— <a href="<%= order.link %>" target="_blank" class="text-decoration-underline text-info">ãƒªãƒ³ã‚¯</a>
          </p>
          <p class="mb-1 text-white">
            ğŸ“¦ æ•°é‡: <span class="fw-bold text-warning"><%= order.quantity %></span>
          </p>
          <p class="mb-1 text-white">
            ğŸ’° é‡‘é¡: <span class="fw-bold text-success"><%= Number(order.price_jpy).toFixed(2) %> å††</span>
          </p>

          <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
          <p class="mb-0 text-white">
            ğŸ“Œ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 
            <% 
              let jpStatus = "ä¸æ˜";
              if (order.status === "completed") jpStatus = "å®Œäº†";
              else if (order.status === "pending") jpStatus = "ä¿ç•™ä¸­";
              else if (order.status === "inprogress") jpStatus = "é€²è¡Œä¸­";
             else if (order.status === "processing") jpStatus = "å‡¦ç†ä¸­";
            %>
            <span class="badge 
              <%= order.status === 'completed' 
                  ? 'bg-success' 
                  : order.status === 'pending' 
                    ? 'bg-warning text-dark' 
                    : order.status === 'inprogress' 
                      ? 'bg-info text-dark' 
                      : 'bg-secondary' %>">
              <%= jpStatus %>
            </span>
          </p>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<style>
  .order-card {
    background: #111; /* é»’èƒŒæ™¯ */
    transition: transform 0.2s, box-shadow 0.2s;
    color: white; /* ã‚«ãƒ¼ãƒ‰å†…ã®æ–‡å­—ã‚’ç™½ã« */
  }
  .order-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 15px rgba(13, 202, 240, 0.6);
  }

/* ===== ã‚¹ãƒãƒ›å‘ã‘ãƒã‚¤ãƒšãƒ¼ã‚¸æœ€é©åŒ– ===== */
.mypage-container {
  max-width: 500px;
  margin: 0 auto;
  padding: 10px;
}

/* ğŸ’³ æ®‹é«˜ãƒ»ãƒ¡ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ */
.user-info-card {
  background: #000814;
  border: 2px solid #0dcaf0;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  text-align: center;
  box-shadow: 0 0 10px rgba(13, 202, 240, 0.5);
}

.user-info-card p {
  margin: 5px 0;
  font-size: 1rem;
}

/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ•ã‚©ãƒ¼ãƒ  */
.password-form {
  background: #0d1117;
  border: 1px solid #30363d;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 25px;
}

.password-form label {
  color: #c9d1d9;
  font-weight: 600;
}

.password-form input {
  width: 100%;
  margin-bottom: 10px;
  background: #000814;
  color: #0dcaf0;
  border: 1px solid #0dcaf0;
  border-radius: 5px;
  padding: 10px;
}

.password-form button {
  width: 100%;
  background: #0dcaf0;
  color: #000;
  border: none;
  font-weight: bold;
  padding: 10px;
  border-radius: 5px;
  transition: 0.3s;
}
.password-form button:hover {
  background: #00b5e0;
}

/* æ³¨æ–‡å±¥æ­´ã‚«ãƒ¼ãƒ‰ */
.order-card {
  background: #0d1117;
  border: 1px solid #0dcaf0;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
  font-size: 0.9rem;
}

.order-card .text-info {
  color: #0dcaf0 !important;
}

.order-card .text-warning {
  color: #ffc107 !important;
}

@media (max-width: 768px) {
  h2 {
    font-size: 1.3rem;
    text-align: center;
  }
  .order-card {
    font-size: 0.85rem;
  }
}
</style>
